<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.meilituibian.api.mapper.WxUserMapper">
    <sql id="select_wx_user">
        select user_id as userId,open_id as openId,nick_name as nickName,sex as sex,city,province,head_url as headUrl,
        remark,create_time as createTime,user_type as userType,contract_no as contractNo,parent,number_id as numberId,phone,address from Wx_User
    </sql>

    <select id="getWxUserById" parameterType="long" resultType="WxUser">
        <include refid="select_wx_user"/>  where user_id=#{id}
    </select>

    <select id="getWxUserByOpenId" parameterType="String" resultType="WxUser">
        <include refid="select_wx_user"/>  where open_id=#{openId}
    </select>

    <insert id="insertWxUser" keyColumn="user_id" useGeneratedKeys="true" parameterType="WxUser">
        insert into wx_user(open_id,nick_name,sex,city,province,head_url,remark,create_time,user_type,contract_no,parent,number_id,phone,address)
        values(#{openId},#{nickName},#{sex},#{city},#{province},#{headUrl},#{remark},#{createTime},#{userType},#{contractNo},#{parent},#{numberId},#{phone},#{address})
    </insert>

    <update id="updateWxUser" >
        update wx_user
        <set>
            <if test="nickName != null">nick_name=#{nickName},</if>
            <if test="sex != null">sex=#{sex},</if>
            <if test="city != null">city=#{city},</if>
            <if test="province != null">province=#{province},</if>
            <if test="head_url != null">head_url=#{headUrl},</if>
            <if test="remark != null">remark=#{remark},</if>
            <if test="userType != null">user_type=#{userType},</if>
            <if test="contractNo != null">contract_no=#{contractNo},</if>
            <if test="phone != null">phone=#{phone},</if>
            <if test="address != null">address=#{address},</if>
            <if test="numberId != null">numberId=#{numberId},</if>
        </set>
        where open_id=#{openId}
    </update>

    <select id="selectChildUser" resultType="WxUser">
        <include refid="select_wx_user"/> where parent=#{openId}
    </select>
</mapper>